const carMarket = {
  sellers: [
    {
      agencyName: "Best Deal",
      cash: 1245000,
      credit: 200000,
      agencyId: "Plyq5M5AZ",
      cars: [
        {
          brand: "bmw",
          models: [
            {
              name: "3",
              year: 2015,
              price: 137000,
              carNumber: "AZJZ4",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "X6",
              year: 2020,
              price: 966500,
              carNumber: "S6DL1",
              ownerId: "Plyq5M5AZ",
            },
          ],
        },
        {
          brand: "toyota",
          models: [
            {
              name: "Land Cruiser",
              year: 2020,
              price: 336300,
              carNumber: "6rvXw",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Hilux",
              year: 2005,
              price: 35005,
              carNumber: "MWXBG",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Corolla",
              year: 2020,
              price: 111900,
              carNumber: "hCzl-",
              ownerId: "Plyq5M5AZ",
            },
          ],
        },
        {
          brand: "Ford",
          models: [
            {
              name: "Focus",
              year: 2020,
              price: 98200,
              carNumber: "kN3HP",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Focus",
              year: 2005,
              price: 6502,
              carNumber: "LJTCs",
              ownerId: "Plyq5M5AZ",
            },
          ],
        },
        {
          brand: "Alpha romeo",
          models: [
            {
              name: "Romeo Julia",
              year: 2020,
              price: 275406,
              carNumber: "2kjy7",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Romeo Stelvio",
              year: 2019,
              price: 215403,
              carNumber: "7A5b-",
              ownerId: "Plyq5M5AZ",
            },
          ],
        },
        {
          brand: "Chevrolet",
          models: [
            {
              name: "Traverse",
              year: 2020,
              price: 201102,
              carNumber: "QwBOT",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Impala",
              year: 2019,
              price: 165041,
              carNumber: "2v4jt",
              ownerId: "Plyq5M5AZ",
            },
            {
              name: "Malibu",
              year: 2017,
              price: 75405,
              carNumber: "O4_Jv",
              ownerId: "Plyq5M5AZ",
            },
          ],
        },
      ],
    },
    {
      agencyName: "CarMax",
      cash: 968541,
      credit: 500000,
      agencyId: "26_IPfHU1",
      cars: [
        {
          brand: "bmw",
          models: [
            {
              name: "X5",
              year: 2015,
              price: 218000,
              carNumber: "4Ixb0",
              ownerId: "26_IPfHU1",
            },
            {
              name: "X6",
              year: 2014,
              price: 97100,
              carNumber: "kAnv-",
              ownerId: "26_IPfHU1",
            },
            {
              name: "Z4",
              year: 2019,
              price: 296900,
              carNumber: "ISMdU",
              ownerId: "26_IPfHU1",
            },
            {
              name: "3",
              year: 2010,
              price: 75100,
              carNumber: "9DJPw",
              ownerId: "26_IPfHU1",
            },
          ],
        },
        {
          brand: "toyota",
          models: [
            {
              name: "Land Cruiser",
              year: 2005,
              price: 80540,
              carNumber: "Kt-pW",
              ownerId: "26_IPfHU1",
            },
            {
              name: "Corolla",
              year: 2019,
              price: 109100,
              carNumber: "YiYdI",
              ownerId: "26_IPfHU1",
            },
            {
              name: "Hilux",
              year: 2019,
              price: 204000,
              carNumber: "DRmNw",
              ownerId: "26_IPfHU1",
            },
          ],
        },
        {
          brand: "Ford",
          models: [
            {
              name: "F250",
              year: 2020,
              price: 198500,
              carNumber: "g4Wfp",
              ownerId: "26_IPfHU1",
            },
            {
              name: "Explorer",
              year: 2020,
              price: 265200,
              carNumber: "iNT8Q",
              ownerId: "26_IPfHU1",
            },
          ],
        },
        {
          brand: "Alpha romeo",
          models: [
            {
              name: "Spider",
              year: 2011,
              price: 75405,
              carNumber: "6t7QU",
              ownerId: "26_IPfHU1",
            },
            {
              name: "166",
              year: 2002,
              price: 12400,
              carNumber: "XMqpn",
              ownerId: "26_IPfHU1",
            },
          ],
        },
        {
          brand: "Chevrolet",
          models: [
            {
              name: "Impala",
              year: 2016,
              price: 65042,
              carNumber: "vbeAo",
              ownerId: "26_IPfHU1",
            },
            {
              name: "Savannah",
              year: 2016,
              price: 76505,
              carNumber: "WelWa",
              ownerId: "26_IPfHU1",
            },
          ],
        },
      ],
    },
    {
      agencyName: "The Auto World",
      cash: 687450,
      credit: 200000,
      agencyId: "gNHjNFL12",
      cars: [
        {
          brand: "bmw",
          models: [
            {
              name: "X6",
              year: 2018,
              price: 548100,
              carNumber: "EMW_7",
              ownerId: "gNHjNFL12",
            },
            {
              name: "3",
              year: 2017,
              price: 178000,
              carNumber: "XlnB4",
              ownerId: "gNHjNFL12",
            },
          ],
        },
        {
          brand: "toyota",
          models: [
            {
              name: "Prius",
              year: 2017,
              price: 101542,
              carNumber: "-RQgN",
              ownerId: "gNHjNFL12",
            },
            {
              name: "Highlander",
              year: 2017,
              price: 202540,
              carNumber: "AZJZ4",
              ownerId: "gNHjNFL12",
            },
            {
              name: "Corolla",
              year: 1996,
              price: 5420,
              carNumber: "kHE8f",
              ownerId: "gNHjNFL12",
            },
            {
              name: "Corolla",
              year: 2012,
              price: 40570,
              carNumber: "p2qEi",
              ownerId: "gNHjNFL12",
            },
          ],
        },
        {
          brand: "Ford",
          models: [
            {
              name: "Explorer",
              year: 2014,
              price: 127502,
              carNumber: "Ty1zN",
              ownerId: "gNHjNFL12",
            },
            {
              name: "F350",
              year: 2012,
              price: 54250,
              carNumber: "z03H2",
              ownerId: "gNHjNFL12",
            },
          ],
        },
        {
          brand: "Chevrolet",
          models: [
            {
              name: "Savannah",
              year: 2010,
              price: 36504,
              carNumber: "RXFZe",
              ownerId: "gNHjNFL12",
            },
            {
              name: "Malibu",
              year: 2009,
              price: 19585,
              carNumber: "K5IsM",
              ownerId: "gNHjNFL12",
            },
          ],
        },
      ],
    },
    {
      agencyName: "Car Werks",
      cash: 302502,
      credit: 150000,
      agencyId: "9KeaYbRLP",
      cars: [
        {
          brand: "bmw",
          models: [
            {
              name: "8",
              year: 2020,
              price: 942500,
              carNumber: "4IUMz",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "X6",
              year: 2010,
              price: 129000,
              carNumber: "Vw0fV",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "X3",
              year: 2019,
              price: 358100,
              carNumber: "ufN54",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "3",
              year: 2020,
              price: 389100,
              carNumber: "F127X",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "3",
              year: 2002,
              price: 18400,
              carNumber: "ueZUp",
              ownerId: "9KeaYbRLP",
            },
          ],
        },
        {
          brand: "toyota",
          models: [
            {
              name: "Prius",
              year: 2011,
              price: 38520,
              carNumber: "AZJZ4",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "Land Cruiser",
              year: 2019,
              price: 290040,
              carNumber: "AZJZ4",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "Hilux",
              year: 2020,
              price: 215700,
              carNumber: "xig8N",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "Hilux",
              year: 2015,
              price: 178506,
              carNumber: "ghTiQ",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "Corolla",
              year: 2002,
              price: 8504,
              carNumber: "Mvw8T",
              ownerId: "9KeaYbRLP",
            },
          ],
        },
        {
          brand: "Chevrolet",
          models: [
            {
              name: "Impala",
              year: 2005,
              price: 9320,
              carNumber: "BZpkt",
              ownerId: "9KeaYbRLP",
            },
            {
              name: "Malibu",
              year: 2002,
              price: 4502,
              carNumber: "KqKV_",
              ownerId: "9KeaYbRLP",
            },
          ],
        },
      ],
    },
    {
      agencyName: "Carsova",
      cash: 72450,
      credit: 50000,
      agencyId: "oqQmsZoUo",
      cars: [
        {
          brand: "bmw",
          models: [
            {
              name: "7",
              year: 1999,
              price: 24700,
              carNumber: "sZrjp",
              ownerId: "oqQmsZoUo",
            },
            {
              name: "3",
              year: 2008,
              price: 54000,
              carNumber: "da88K",
              ownerId: "oqQmsZoUo",
            },
          ],
        },
        {
          brand: "toyota",
          models: [
            {
              name: "Prius",
              year: 2019,
              price: 124050,
              carNumber: "ZfbqH",
              ownerId: "oqQmsZoUo",
            },
            {
              name: "Hilux",
              year: 1996,
              price: 11540,
              carNumber: "AZJZ4",
              ownerId: "oqQmsZoUo",
            },
          ],
        },
      ],
    },
  ],
  customers: [
    {
      name: "Lilah Goulding",
      id: "BGzHhjnE8",
      cars: [
        {
          name: "Corolla",
          year: 2013,
          price: 40570,
          carNumber: "16da1",
          ownerId: "BGzHhjnE8",
        },
      ],
      cash: 35000,
    },
    {
      name: "Ravi Murillo",
      id: "2RprZ1dbL",
      cars: [
        {
          name: "M5",
          year: 2019,
          price: 578054,
          carNumber: "WIh0U",
          ownerId: "2RprZ1dbL",
        },
        {
          name: "Spider",
          year: 2012,
          price: 81520,
          carNumber: "RLS4q",
          ownerId: "2RprZ1dbL",
        },
      ],
      cash: 278542,
    },
    {
      name: "Aleksander Carr",
      id: "pAuFtn_WA",
      cars: [
        {
          name: "Highlander",
          year: 2018,
          price: 214503,
          carNumber: "2WU_y",
          ownerId: "pAuFtn_WA",
        },
      ],
      cash: 125402,
    },
    {
      name: "Lana Edge",
      id: "cnTobUDy6",
      cars: [
        {
          name: "F250",
          year: 2020,
          price: 198500,
          carNumber: "Xxcy_",
          ownerId: "cnTobUDy6",
        },
        {
          name: "Hilux",
          year: 2005,
          price: 35005,
          carNumber: "VSCUj",
          ownerId: "cnTobUDy6",
        },
      ],
      cash: 7000,
    },
    {
      name: "Nikita Philip",
      id: "5x2tMcX4R",
      cars: [
        {
          name: "Impala",
          year: 2016,
          price: 65042,
          carNumber: "LKInp",
          ownerId: "5x2tMcX4R",
        },
      ],
      cash: 40541,
    },
    {
      name: "Bob Steel",
      id: "Wm6BkA1F0",
      cars: [],
      cash: 15732,
    },
    {
      name: "Will Reyes",
      id: "FQvNsEwLZ",
      cars: [
        { name: "X6", year: 2020, price: 966500, ownerId: "FQvNsEwLZ" },
        {
          name: "Land Cruiser",
          year: 2020,
          price: 336300,
          carNumber: "vaJvd",
          ownerId: "FQvNsEwLZ",
        },
        {
          name: "Romeo Julia",
          year: 2020,
          price: 275406,
          carNumber: "qLoYR",
          ownerId: "FQvNsEwLZ",
        },
        {
          name: "Explorer",
          year: 2020,
          price: 265200,
          carNumber: "tlGRq",
          ownerId: "FQvNsEwLZ",
        },
      ],
      cash: 1547242,
    },
  ],
  taxesAuthority: {
    totalTaxesPaid: 0,
    sumOfAllTransactions: 0,
    numberOfTransactions: 0,
  },
};

//! agency's func's
//todo getters

//* getAgencyByName
//? @param {string} - name
//? @return {Object} - agency object

carMarket.getAgencyByName = function (str) {
  return this.sellers.find((name) => name.agencyName === str);
};

carMarket.getAgencyByName("Best Deal");
// console.log(carMarket.getAgencyByName("Best Deal"));

//!======================================================================

//* getAgencyIdByID
//? @param {String} - name
//? @return {String} - agencyId

// carMarket.getAgencyIdByID = function (strName) {
//   return this.sellers.find((name) => name.agencyName === strName).agencyId;
// };

// same as above but shorter
carMarket.getAgencyIdByID = function (str) {
  return this.getAgencyByName(str).agencyId;
};

// console.log(carMarket.getAgencyIdByID("The Auto World"));

// !======================================================================

//* getAllAgenciesName
//? @param {}
//? @return {string[]} - agenciesNameArr - Array of all agencies name

carMarket.getAllAgenciesName = function () {
  return this.sellers.map((name) => name.agencyName);
};

// console.log(carMarket.getAllAgenciesName());

// !=====================================================================
//* getAllCarToBuy
//? @param {}
//? @return {object[]} - allCarsToBuy - arrays of all cars objects

carMarket.getAllCarToBuy = function () {
  return this.sellers.map((carsByAgency) => carsByAgency.cars);
};

// console.log(carMarket.getAllCarToBuy());

// !===================================================================

//* getAllCarToBuyByAgencyId
//? @param {string} - id of agency
//? @return {object[]} - carsArray - arrays of all models objects of specific agency

carMarket.getAllCarToBuyByAgencyId = function (IDstr) {
  return this.sellers.find((byID) => byID.agencyId === IDstr).cars;
};

// console.log(carMarket.getAllCarToBuyByAgencyId("Plyq5M5AZ"));

// !======================================================================
//* getAllBrandsToBuyAgencyId
//? @param {string} - agencyId -  id of agency
// ? @return {string[]} - arrOfBrands - arrays of all brands name in specific agency

carMarket.getAllBrandsToBuyAgencyId = function (IDstr) {
  return this.sellers.find((id) => id.agencyId === IDstr).cars.map((byBrand) => byBrand.brand);
};

// console.log(carMarket.getAllBrandsToBuyAgencyId("Plyq5M5AZ"));

// !=================================================================================
// !=================================================================================

//! customer func's
//todo getters
//* getCustomerByName
//? @param {string} - name
//? @return {Object} - customer

carMarket.getCustomerByName = function (nameStr) {
  return this.customers.find((customer) => customer.name === nameStr);
};

// console.log(carMarket.getCustomerByName("Lilah Goulding"));

// !=========================================================================
//* getCustomerIdByName
//? @param {name}
//? @return {String} - customerId - The customer id

carMarket.getCustomerIdByName = function (nameStr) {
  return this.getCustomerByName(nameStr).id;
};

// console.log(carMarket.getCustomerIdByName("Lilah Goulding"));

// !===================================================================

//* getAllCustomersNames
//? @param {}
//? @return {string[]} - customersNameArr -  Array of all customers name

carMarket.getAllCustomersNames = function () {
  return this.customers.map((customer) => customer.name);
};

// console.log(carMarket.getAllCustomersNames());

// !======================================================================
//* getAllCustomerCars
//? @param {id} - costumerId - costumer id
//? @return {object[]} - customerCarsArr -  Array of all customer cars object

carMarket.getAllCustomerCars = function (strID) {
  return this.customers.find((customer) => customer.id === strID).cars;
};

// console.log(carMarket.getAllCustomerCars("2RprZ1dbL"));

// !===================================================================
//* getCustomerCash
//? @param {id} - costumerId - costumer id
//? @return {number} - CustomerCash

carMarket.getCustomerCash = function (strID) {
  return this.customers.find((customer) => customer.id === strID).cash;
};

// console.log(carMarket.getCustomerCash("pAuFtn_WA"));

// !========================================================================
// !========================================================================
// !========================================================================

//*  1) setPropertyBrandToAllCars
//? set all cars model object the current brand
//? @param {}
//? @return {}

carMarket.setPropertyBrandToAllCars = function () {
  const brandobj = {};

  // sellers only
  for (seller of this.sellers) {
    for (cars of seller.cars) {
      for (data of cars.models) {
        data.brand = cars.brand;
        !brandobj[cars.brand]
          ? (brandobj[cars.brand] = [])
          : brandobj[data.brand].indexOf(data.name) === -1 && brandobj[data.brand].push(data.name); //data.name;
      }
    }
  }

  // console.log(brandobj);

  //   customers only
  for (customer of this.customers) {
    for (car of customer.cars) {
      // car.brand = "benny";
      for (brands in brandobj) {
        if (!car.brand) car.brand = brandobj[brands].find((model) => model === car.name);
      }
    }
  }
};

carMarket.setPropertyBrandToAllCars();
// console.log(carMarket.sellers[0].cars[0].models);
// console.log(carMarket.customers[2].cars);
// !================================================

//todo Agency setters
//* setNewCarToAgency
//? @param {string} - id of agency
//? @param {object} - carObject
//? @return {}
carMarket.setNewCarToAgency = function (strID, carObj) {
  this.sellers.find((agency) => agency.agencyId === strID).cars.push(carObj);
};

const newCarToAdd = {
  brand: "Seat",
  models: [
    {
      name: "Ibiza",
      year: 2020,
      price: 136300,
      carNumber: "zxvXw",
      ownerId: "Plyq5M5AZ",
    },
    {
      name: "Leon",
      year: 2005,
      price: 55005,
      carNumber: "P5XBG",
      ownerId: "Plyq5M5AZ",
    },
  ],
};

carMarket.setNewCarToAgency("Plyq5M5AZ", newCarToAdd);
// console.log(carMarket.sellers[0].cars);

// !==================================================================
//* deleteCarFromAgency
//? @param {string} - id of agency
//? @param {string} -  Car id
// ? @return {}

carMarket.deleteCarFromAgency = function (agencyID, carID) {
  const carList = this.sellers.find((agency) => agency.agencyId === agencyID).cars;
  for (carObj of carList) {
    for (let carIdx = 0; carIdx < carObj.models.length; carIdx++) {
      if (carObj.models[carIdx].carNumber === carID) {
        carObj.models.splice(carIdx, 1);
      }
    }
  }
};

// carMarket.deleteCarFromAgency("Plyq5M5AZ", "AZJZ4");
// console.log(carMarket.sellers[0].cars[0]);

// !====================================================================
//* decrementOrIncrementCashOfAgency
//? @param {string} - agencyId
//? @param {number} - amount - negative or positive amount
// ? @return {number} - agencyCash

carMarket.decrementOrIncrementCashOfAgency = function (strID, cashNum) {
  this.sellers.find((agency) => agency.agencyId === strID).cash += cashNum;
  return this.sellers.find((agency) => agency.agencyId === strID).cash;
};

// console.log(carMarket.decrementOrIncrementCashOfAgency("Plyq5M5AZ", -1));
// console.log(carMarket.sellers[0]);

// !===================================================
//* decrementOrIncrementCreditOfAgency
//? @param {string} - agencyId
//? @param {number} - amount - negative or positive amount
// ? @return {number} - agencyCredit

carMarket.decrementOrIncrementCreditOfAgency = function (strID, cashNum) {
  this.sellers.find((agency) => agency.agencyId === strID).credit += cashNum;
  return this.sellers.find((agency) => agency.agencyId === strID).credit;
};

// !==================================================
//* setAmountOfCarsToBuyToAllAgency's
//? set a new property amountOfCars to all agency's, that represent the amount of cars available in the agency.
//? @param {}
// ? @return {objects[]} - sellers - array of all agency's

carMarket.setAmountOfCarsToBuyToAllAgency = function () {
  for (agency of this.sellers) {
    agency.carsInventory = agency.cars.reduce((total, cur) => {
      total += cur.models.length;
      return total;
    }, 0);
  }
};

carMarket.setAmountOfCarsToBuyToAllAgency();
// console.log(carMarket.sellers[0]);
// ! ========================================
//todo setters
//* setCarToCostumer
//? @param {string} - costumerId
//? @param {object} - carObject
//? @return {object[]} - allCarsOfCostumer

carMarket.setCarToCostumer = function (costumerId, carObject) {
  const findCustomer = this.customers.find((cusomer) => cusomer.id === costumerId);
  findCustomer.cars.push(carObject);
  carObject.ownerId = findCustomer.id;
  return this.customers.find((cusomer) => cusomer.id === costumerId).cars;
};

const newCarToAddtoCustomer = {
  name: "Skoda",
  year: 2013,
  price: 80570,
  carNumber: "19dxz",
  // ownerId: "BGzHhjnE8",
};

carMarket.setCarToCostumer("BGzHhjnE8", newCarToAddtoCustomer);
// console.log(carMarket.customers[0]);
// !==============================================================

//* deleteCarOfCostumer
//? @param {string} - costumerId
//? @param {string} - carId
//? @return {object[]} - allCarsOfCostumer

carMarket.deleteCarOfCostumer = function (strID, carID) {
  const customerCarsList = this.customers.find((cusomer) => cusomer.id === strID).cars;
  for (let carIdx = 0; carIdx < customerCarsList.length; carIdx++) {
    if (customerCarsList[carIdx].carNumber === carID) {
      customerCarsList.splice(carIdx, 1);
    }
  }
};

// carMarket.deleteCarOfCostumer("BGzHhjnE8", "16da1");
// console.log(carMarket.customers[0]);

// !===============================================
//* decrementOrIncrementCashOfCostumer
//? @param {string} - costumerId
//? @param {number} - amount - negative or positive amount
// ? @return {number} - costumerCash

carMarket.decrementOrIncrementCashOfCostumer = function (strID, numCash) {
  const customerobj = this.customers.find((cusomer) => cusomer.id === strID);
  customerobj.cash += numCash;
  return customerobj.cash;
};

carMarket.decrementOrIncrementCashOfCostumer("BGzHhjnE8", 999);
// console.log(carMarket.customers[0]);

// ! another thing to do
//! -------------------------------------------------------
//! -------------------------------------------------------
//! -------------------------------------------------------
//* 2) sortAndFilterByYearOfProduction
//?   filter and Sort in a Ascending or Descending order all vehicles for sale by year of production.
//?   @param {object[]} - arrOfCars - array of cars
//?   @param {number} - fromYear - Will display vehicles starting this year
//?   @param {number} - toYear - Will display vehicles up to this year
//?   @param {boolean} - isAscendingOrder - true for ascending order, false for descending order
//?   @return {object[]} - arrayOfModels - array of sorted cars

carMarket.sortAndFilterByYearOfProduction = function (fromYear, toYear, isAscendingOrder) {
  const arrayOfCars = [];
  for (seller of this.sellers) {
    for (car of seller.cars) {
      for (model of car.models) {
        arrayOfCars.push(model);
      }
    }
  }
  // console.log(arrayOfCars); //?Good

  const arrayOfCarsByYear = arrayOfCars.filter((car) => car.year >= fromYear && car.year < toYear);
  // console.log(arrayOfCarsByYear);
  if (isAscendingOrder) {
    return arrayOfCarsByYear.sort((a, b) => a.year - b.year);
  }
  return arrayOfCarsByYear.sort((a, b) => b.year - a.year);
};

// ?PERFECT
// console.log(carMarket.sortAndFilterByYearOfProduction(2000, 2018, true));
// console.log(carMarket.sortAndFilterByYearOfProduction(2000, 2010, false));

// !=====================================================================
//* 3) sortAndFilterByPrice
//?   filter and Sort in a Ascending or Descending order all vehicles for sale by price of the cars.
//?   @param {object[]} - arrOfCars - array of cars
//?   @param {number} - fromPrice - Will display vehicles starting at this price
//?   @param {number} - fromPrice - Will display vehicles up to this price
//?   @param {boolean} - isAscendingOrder - true for ascending order, false for descending order
//?   @return {object[]} - arrayOfModels - array of sorted cars

carMarket.sortAndFilterByPrice = function (fromPrice, toPrice, isAscendingOrder) {
  const carsList = [];
  for (let seller of this.sellers) {
    for (let car of seller.cars) {
      for (let model of car.models) {
        model.price >= fromPrice && model.price < toPrice && carsList.push(model);
      }
    }
  }
  // console.log(carsList);
  return isAscendingOrder ? carsList.sort((a, b) => a.price - b.price) : carsList.sort((a, b) => b.price - a.price);
};

// console.log(carMarket.sortAndFilterByPrice(200000, 250000, true));
// !====================================================================
// todo
//* 4 ) searchCar
//?   @param {object[]} - arrOfCars - array of cars
//?   @param {number} - fromYear - Will display vehicles starting this year
//?   @param {number} - toYear - Will display vehicles up to this year
//?   @param {number} - fromPrice - Will display vehicles starting at this price
//?   @param {number} - fromPrice - Will display vehicles up to this price
//?   optional @param {string} - brand - Look only for cars of this brand

carMarket.searchCar = function (fromYear, toYear, fromPrice, toPrice, brandStr) {
  return this.sortAndFilterByYearOfProduction(fromYear, toYear, true)
    .filter((brandOfCar) => brandOfCar.brand === brandStr)
    .filter((checkPrice) => {
      return checkPrice.price >= fromPrice && checkPrice.price < toPrice;
    });
};

// console.log(carMarket.searchCar(2014, 2016, 185000, 280000, "bmw"));
// console.log(carMarket.searchCar(2010, 2016, 185000, 280000, "bmw"));

// !=============================================================

//* 5 ) sellCar
//?   Sell ​​a car to a specific customer
//?   @param {string} - agencyId
//?   @param {string} - customerId
//?   @param {string} - carModel
//?   @return {object} - The object of the car purchased by the customer or an explanation message
//*done     - 5a. Subtract the vehicle amount + 17% (tax) from the customer's cash.
//*done    - 5b. Add the vehicle value to the car agency cash.
//*done    - 5c. Change the car owner's id to the customer's id.
//*done     - 5d. Remove the car from the array of the agency's car models.
//*done    - 5e. Add the car to the client cars array.
// *
// *done     Taxes Authority:
// *done     - 5f. Pay 17 percent of the vehicle value to the tax authority. (add the amount to totalTaxesPaid)
// *done     - 5g. Increase the number of transactions made in one (numberOfTransactions)
//*done     - 5h. Add the vehicle amount + tax to sumOfAllTransactions

//! done     - Check that there is the requested vehicle at the agency in not return 'The vehicle does not exist at the agency'
//! done     - Check that the customer has enough money to purchase the vehicle, if not return 'The customer does not have enough money'

//!      - Try to divide the tasks into several functions and try to maintain a readable language.

carMarket.sellCar = function (agencyID, customerID, carModel) {
  /* getAllCarToBuyByAgencyId(agencyID) >> return all cars available as array of obj. Extract the specific car object, from that obj extract the price. if no valid car - return massage. */

  const carObjSold = this.getAllCarToBuyByAgencyId(agencyID)
    .find((car) => car.models.find((model) => model.name === carModel || []))
    .models.find((model) => model.name === carModel);
  // console.log(carObjSold);

  if (carObjSold === undefined) {
    //
    const agencyName = this.sellers.find((ID) => ID.agencyId === agencyID).agencyName;
    const invalidMsg = `${carModel} is not avilable in ${agencyName} agency.`;
    return invalidMsg;
  }
  const carPrice = carObjSold.price;
  // console.log(carPrice);

  //! ------------------------------------------------
  //* /*Money section*/

  const customerCash = this.getCustomerCash(customerID); // >>> return cash
  if (customerCash < carPrice) {
    // console.log(customerCash, carPrice);
    const invalidMsg = `Sorry , the price of ${carObjSold.brand} model ${carObjSold.name} is ${carPrice}$.\nYou can't buy this car with ${customerCash}$. `;
    // console.log(invalidMsg);
    return invalidMsg;
  }

  const taxOfthisTransaction = carPrice * 0.17;

  //? decrement cash from customer
  this.decrementOrIncrementCashOfCostumer(customerID, -(carPrice + taxOfthisTransaction));
  // console.log(this.getCustomerCash(customerID));

  //? increment cash to agency
  this.decrementOrIncrementCashOfAgency(agencyID, carPrice);
  // console.log(this.decrementOrIncrementCashOfAgency(agencyID, carPrice));

  // taxesAuthority section
  this.taxesAuthority.totalTaxesPaid += taxOfthisTransaction;
  this.taxesAuthority.sumOfAllTransactions += carPrice * 1.17;
  this.taxesAuthority.numberOfTransactions += 1;

  // !----------------------------------------------------------
  // Delete from agency
  this.deleteCarFromAgency(agencyID, carObjSold.carNumber);
  this.setAmountOfCarsToBuyToAllAgency();
  // console.log(this.sellers[0], carObjSold.carNumber);

  // Change owenership id
  carObjSold.ownerId = customerID;
  // console.log(carObjSold);

  // Add car to customer
  this.setCarToCostumer(customerID, carObjSold);

  const completionMassage = `Congratulation, transaction completed.`;

  return completionMassage;
};

// console.log(carMarket.sellCar("Plyq5M5AZ", "2RprZ1dbL", "33"));
console.log(carMarket.sellCar("Plyq5M5AZ", "2RprZ1dbL", "3"));
// console.log(carMarket.taxesAuthority);
// console.log(carMarket.customers[1]);
// console.log(carMarket.sellers[0].cars[0].models);
